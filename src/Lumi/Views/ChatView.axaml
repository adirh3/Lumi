<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Lumi.ViewModels"
             xmlns:sc="using:StrataTheme.Controls"
             x:Class="Lumi.Views.ChatView"
             x:CompileBindings="False">

  <UserControl.Styles>
    <!-- Show Retry on user messages (theme hides it) -->
    <Style Selector="sc|StrataChatMessage:user /template/ Button#PART_RegenerateButton">
      <Setter Property="IsVisible" Value="True" />
    </Style>
    <!-- Hide Retry on assistant messages -->
    <Style Selector="sc|StrataChatMessage:assistant /template/ Button#PART_RegenerateButton">
      <Setter Property="IsVisible" Value="False" />
    </Style>
  </UserControl.Styles>

  <Panel>
    <!-- Welcome state (no active chat) -->
    <Panel x:Name="WelcomePanel">
      <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="24" MaxWidth="520">
        <!-- Animated orb -->
        <Border x:Name="WelcomeOrb" Width="80" Height="80" CornerRadius="40"
                Background="{DynamicResource Brush.AccentGradient}"
                HorizontalAlignment="Center" Opacity="0.9">
          <TextBlock Text="L" FontSize="36" FontWeight="Bold"
                     Foreground="{DynamicResource Brush.TextOnAccent}"
                     HorizontalAlignment="Center" VerticalAlignment="Center" />
        </Border>

        <StackPanel Spacing="8" HorizontalAlignment="Center">
          <TextBlock Classes="headline" Text="What can I help with?"
                     HorizontalAlignment="Center" />
          <TextBlock Classes="secondary" TextAlignment="Center" TextWrapping="Wrap"
                     Text="Start a conversation, use a skill, or switch to a Lumi agent for specialized help." />
        </StackPanel>

        <!-- Quick composer -->
        <StackPanel Spacing="4">
          <sc:StrataAttachmentList x:Name="WelcomePendingAttachmentList"
                                   ShowAddButton="False"
                                   IsVisible="False" />
          <sc:StrataChatComposer x:Name="WelcomeComposer"
                                 Placeholder="Message Lumi…"
                                 PromptText="{Binding PromptText, Mode=TwoWay}"
                                 IsBusy="{Binding IsBusy}"
                                 Models="{Binding AvailableModels}"
                                 SelectedModel="{Binding SelectedModel, Mode=TwoWay}"
                                 QualityLevels="{x:Null}"
                                 SuggestionA="Plan my day"
                                 SuggestionB="Summarize this"
                                 SuggestionC="Help me write"
                                 SkillItems="{Binding ActiveSkillChips}" />
        </StackPanel>
      </StackPanel>
    </Panel>

    <!-- Active chat -->
    <Panel x:Name="ChatPanel" IsVisible="False">
      <sc:StrataChatShell x:Name="ChatShell" IsOnline="True"
                          VerticalAlignment="Stretch">

        <sc:StrataChatShell.Header>
          <DockPanel Margin="0,0,8,0">
            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Spacing="8"
                        VerticalAlignment="Center">
              <Border x:Name="AgentBadge" IsVisible="False"
                      Background="{DynamicResource Brush.AccentSubtle}" CornerRadius="12" Padding="10,4">
                <TextBlock x:Name="AgentBadgeText" Classes="caption" FontWeight="SemiBold"
                           Foreground="{DynamicResource Brush.AccentDefault}" />
              </Border>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
              <Border Width="28" Height="28" CornerRadius="8"
                      Background="{DynamicResource Brush.AccentGradient}">
                <TextBlock Text="L" FontSize="13" FontWeight="Bold"
                           Foreground="{DynamicResource Brush.TextOnAccent}"
                           HorizontalAlignment="Center" VerticalAlignment="Center" />
              </Border>
              <TextBlock Classes="body-strong" Text="{Binding CurrentChat.Title}" />
            </StackPanel>
          </DockPanel>
        </sc:StrataChatShell.Header>

        <sc:StrataChatShell.Transcript>
          <ItemsControl ItemsSource="{Binding Messages}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Panel Margin="0,4" />
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </sc:StrataChatShell.Transcript>

        <sc:StrataChatShell.Composer>
          <StackPanel Spacing="4">
            <sc:StrataAttachmentList x:Name="PendingAttachmentList"
                                     ShowAddButton="False"
                                     IsVisible="False" />
            <sc:StrataChatComposer x:Name="ActiveComposer"
                                  Placeholder="Message Lumi…"
                                  PromptText="{Binding PromptText, Mode=TwoWay}"
                                  IsBusy="{Binding IsBusy}"
                                  Models="{Binding AvailableModels}"
                                  SelectedModel="{Binding SelectedModel, Mode=TwoWay}"
                                  QualityLevels="{x:Null}"
                                  SkillItems="{Binding ActiveSkillChips}" />
          </StackPanel>
        </sc:StrataChatShell.Composer>

      </sc:StrataChatShell>
    </Panel>
  </Panel>
</UserControl>
