<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Lumi.ViewModels"
             xmlns:models="using:Lumi.Models"
             x:Class="Lumi.Views.ProjectsView"
             x:DataType="vm:ProjectsViewModel">

  <Grid ColumnDefinitions="*,16,1.2*" Margin="32,24">

    <!-- Left: project list -->
    <DockPanel Grid.Column="0">
      <StackPanel DockPanel.Dock="Top" Spacing="12" Margin="0,0,0,16">
        <DockPanel>
          <Button DockPanel.Dock="Right" Classes="accent" Content="ï¼‹ New Project"
                  Command="{Binding NewProjectCommand}" />
          <TextBlock Classes="headline" Text="Projects" VerticalAlignment="Center" />
        </DockPanel>
        <TextBox Watermark="Search projectsâ€¦" Text="{Binding SearchQuery}" />
      </StackPanel>

      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <ItemsControl ItemsSource="{Binding Projects}">
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="models:Project">
              <Button Classes="subtle" HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left" Margin="0,2"
                      Command="{Binding $parent[UserControl].((vm:ProjectsViewModel)DataContext).EditProjectCommand}"
                      CommandParameter="{Binding}">
                <DockPanel>
                  <Button Classes="subtle" DockPanel.Dock="Right"
                          Content="ðŸ—‘" FontSize="12" Padding="6,2" Opacity="0.5"
                          Command="{Binding $parent[UserControl].((vm:ProjectsViewModel)DataContext).DeleteProjectCommand}"
                          CommandParameter="{Binding}" />
                  <StackPanel Orientation="Horizontal" Spacing="10">
                    <Border Width="32" Height="32" CornerRadius="8"
                            Background="{DynamicResource Brush.AccentSubtle}">
                      <TextBlock Text="ðŸ“" FontSize="16"
                                 HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <StackPanel Spacing="2" VerticalAlignment="Center">
                      <TextBlock Text="{Binding Name}" FontWeight="Medium" />
                      <TextBlock Classes="caption" Foreground="{DynamicResource Brush.TextTertiary}"
                                 Text="{Binding CreatedAt, StringFormat='{}{0:MMM d, yyyy}'}" />
                    </StackPanel>
                  </StackPanel>
                </DockPanel>
              </Button>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </DockPanel>

    <!-- Right: editor -->
    <Border Grid.Column="2" Classes="strata-card" Padding="24,20"
            IsVisible="{Binding IsEditing}">
      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="16">
          <TextBlock Classes="title" Text="Project Editor" />
          <Border Height="1" Background="{DynamicResource Brush.BorderSubtle}" />

          <StackPanel Spacing="6">
            <TextBlock Classes="caption" FontWeight="Medium" Text="Name" />
            <TextBox Text="{Binding EditName}" Watermark="e.g. My App" />
          </StackPanel>

          <StackPanel Spacing="6">
            <TextBlock Classes="caption" FontWeight="Medium" Text="Instructions" />
            <TextBox Text="{Binding EditInstructions}" AcceptsReturn="True" TextWrapping="Wrap"
                     MinHeight="200" Watermark="Special instructions for chats in this projectâ€¦" />
          </StackPanel>

          <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
            <Button Classes="accent" Content="Save" Command="{Binding SaveProjectCommand}" />
            <Button Content="Cancel" Command="{Binding CancelEditCommand}" />
          </StackPanel>
        </StackPanel>
      </ScrollViewer>
    </Border>

    <!-- Empty state -->
    <Border Grid.Column="2" IsVisible="{Binding !IsEditing}"
            HorizontalAlignment="Center" VerticalAlignment="Center">
      <StackPanel Spacing="8" HorizontalAlignment="Center">
        <TextBlock Classes="title" Text="ðŸ“" FontSize="40" HorizontalAlignment="Center" />
        <TextBlock Classes="secondary" Text="Select a project to edit or create a new one"
                   HorizontalAlignment="Center" />
      </StackPanel>
    </Border>
  </Grid>
</UserControl>
